import{a1 as f,a2 as E}from"./clientConfigs-8aa21dc4.js";const R={},L=()=>R,x=Object.freeze({cancelLastRequest:!0,cancelOnDispose:!0,useLastRequest:!1,cacheTime:0,retryTimes:0}),B=(q,A)=>{const e={...x,...L(),...A},m=f(null),v=f(!1),b=f(null),t={result:m,loading:v,error:b};let u=new AbortController,c=!1,y=0,w=null,s=0;const d=r=>r.message==="canceled"||r.name==="AbortError",g=(r,n=!1)=>{var l,o;t.result.value=r,t.error.value=null,a(!1),n||(y=Date.now(),w=r),(l=e.onSuccess)==null||l.call(e,r),(o=e.onAfter)==null||o.call(e)},T=r=>{var n,l;d(r)||(t.result.value=null,t.error.value=r,a(!1),(n=e.onError)==null||n.call(e,r),(l=e.onAfter)==null||l.call(e))},a=r=>{t.loading.value=r,c=r},p=async(...r)=>{const n=u;for(;s<=e.retryTimes;){try{const l=await q(n.signal,...r);return n.signal.aborted?new Error("canceled"):(g(l),l)}catch(l){if(d(l))return l;if(s===e.retryTimes)return T(l),l}s++}return new Error("unexpected error")},h=async(...r)=>{var n,l;if(e.useLastRequest&&c)return new Error("waiting for last request");if((n=e.onBefore)==null||n.call(e),s=0,w&&Date.now()-y<e.cacheTime){a(!0);const o=await new Promise(D=>setTimeout(()=>{D(w)},20));return(l=e.onCache)==null||l.call(e,o),g(o,!0),o}return e.cancelLastRequest&&c&&(i(),u=new AbortController),a(!0),await p(...r)},C=async(...r)=>{var n;return(n=e.onBefore)==null||n.call(e),s=0,c&&(i(),u=new AbortController),a(!0),await p(...r)},i=()=>{var r;(r=e.onCancel)==null||r.call(e),a(!1),u.abort("cancel request")};return E(()=>{e.cancelOnDispose&&c&&i()}),{result:m,loading:v,error:b,run:h,forceRun:C,cancel:i}},S=B;export{S as N};
